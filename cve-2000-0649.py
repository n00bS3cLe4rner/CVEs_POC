#!/usr/bin/env python3
# Written by Rafe Hart (@rafael_hart)
""" Test an IP address (port 443) for CVE-2000-0649 """

import ssl
import socket
import re
import sys

def test_ip_for_cve(ip):
    try:
        with socket.create_connection((ip, 443)) as sock:
            context = ssl.SSLContext(ssl.PROTOCOL_TLS_CLIENT)
            context.verify_mode = ssl.CERT_NONE  # Disable certificate verification
            with context.wrap_socket(sock, server_hostname=ip) as s:
                s.sendall(b'GET / HTTP/1.0\r\n\r\nConnection: close\r\n\r\n')
                while True:
                    new = s.recv(4096)
                    if not new:
                        break
                    try:
                        response = new.decode()
                        pattern = re.compile(r'(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})')
                        if pattern.search(response):
                            print(ip, "->", pattern.search(response).group())
                    except Exception as e:
                        print("Error while processing response:", e)
    except Exception as exc:
        print("Connection to", ip, "failed:", exc)

def main():
    if len(sys.argv) != 2:
        print("\nUsage: cve-2000-0643.py <example.com> or <IP>\n")
        sys.exit(1)
    target = sys.argv[1]
    test_ip_for_cve(target)

if __name__ == '__main__':
    main()
